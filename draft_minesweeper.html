<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Elegant Minesweeper</title>
<style>
  :root{
    --bg:#0f1724;
    --panel:#0b1220;
    --tile:#0f1728;
    --muted:#9aa7b2;
    --accent:#7dd3fc;
    --success:#34d399;
    --danger:#fb7185;
    --glass: rgba(255,255,255,0.03);
    --glass-2: rgba(255,255,255,0.02);
    --tile-shadow: 0 6px 18px rgba(2,6,23,0.6);
    --glass-border: rgba(255,255,255,0.03);
    font-family: Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    background: linear-gradient(180deg,#071026 0%, var(--bg) 100%);
    color:#dbeafe;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:28px;
    gap:24px;
  }

  .container{
    width:100%;
    max-width:1080px;
    display:flex;
    gap:20px;
    align-items:flex-start;
    justify-content:center;
  }

  .panel {
    background: linear-gradient(180deg,var(--panel), rgba(8,12,20,0.8));
    border-radius:14px;
    padding:18px;
    box-shadow: var(--tile-shadow);
    border:1px solid var(--glass-border);
    backdrop-filter: blur(6px) saturate(1.1);
  }

  .left, .right { display:flex; flex-direction:column; gap:14px; }
  .left { min-width:320px; max-width:480px; flex:1 }
  .right { min-width:280px; width:320px }

  header.app-header{
    display:flex; align-items:center; gap:12px; justify-content:space-between;
  }
  h1{font-size:18px;margin:0;font-weight:600;letter-spacing:0.2px}
  .subtitle{font-size:12px;color:var(--muted)}
  .controls{display:flex; gap:10px; align-items:center}
  .btn{
    background:var(--glass);
    padding:8px 10px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);
    cursor:pointer;color:inherit;font-weight:600;font-size:13px;
    display:inline-flex;align-items:center;gap:8px;
    transition:transform .12s ease,box-shadow .12s ease,opacity .12s;
  }
  .btn:hover{transform:translateY(-3px); box-shadow: 0 8px 18px rgba(2,6,23,0.6)}
  .btn:active{transform:translateY(0)}
  .btn.ghost{background:transparent;border:1px dashed var(--glass-border)}
  .btn.danger{background:linear-gradient(180deg,#3b0f1a,#260710); color: #ffd7dc}

  .stats {
    display:flex; gap:8px; align-items:center; justify-content:space-between;
    margin-top:10px;
  }
  .stat{
    background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    padding:8px 10px;border-radius:10px; min-width:80px;
    display:flex;flex-direction:column;align-items:center;gap:4px;border:1px solid var(--glass-border)
  }
  .stat .big{font-size:20px; font-weight:700}
  .stat .small{font-size:12px;color:var(--muted)}

  .board-wrap{
    margin-top:14px;
    display:flex;align-items:center;justify-content:center;
    padding:8px;
    background:linear-gradient(180deg, rgba(255,255,255,0.012), rgba(255,255,255,0.01));
    border-radius:12px;
    border:1px solid rgba(255,255,255,0.02);
  }

  /* Grid */
  .board{
    display:grid;
    gap:8px;
    padding:12px;
    border-radius:10px;
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  }

  /* Tile */
  .tile{
    width:36px;height:36px;border-radius:8px;
    display:flex;align-items:center;justify-content:center;
    font-weight:700;font-size:16px;
    color:#0b1220;
    background: linear-gradient(180deg,#e6eef6,#cfe4f6);
    box-shadow: 0 6px 0 rgba(255,255,255,0.06), inset 0 -3px 0 rgba(255,255,255,0.3);
    cursor:pointer;user-select:none;transition:transform .08s ease, box-shadow .08s;
    position:relative;
  }
  .tile.hidden{
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.02));
    color:var(--muted); font-weight:600;
    box-shadow: 0 6px 18px rgba(2,6,23,0.6);
  }
  .tile:active{transform:translateY(2px)}
  .tile.flagged{background:linear-gradient(180deg,#fff6f0,#ffd6cc)}
  .tile.mine{background: linear-gradient(180deg,#ffd6d6,#ffb3b3); color:var(--danger)}
  .tile.revealed{background: linear-gradient(180deg,#e9fbf4,#d8f8ea); color:var(--panel)}
  .tile.number-1{color:#1976d2}
  .tile.number-2{color:#2e7d32}
  .tile.number-3{color:#d32f2f}
  .tile.number-4{color:#512da8}
  .tile.number-5{color:#c2185b}
  .tile.number-6{color:#00796b}
  .tile.number-7{color:#3e2723}
  .tile.number-8{color:#455a64}

  /* small screens */
  @media (max-width:720px){
    .container{flex-direction:column;padding:16px}
    .left,.right{width:100%}
    .tile{width:32px;height:32px;border-radius:6px;font-size:15px}
  }

  /* toast */
  .toast-wrap{position:fixed;right:24px;top:24px;display:flex;flex-direction:column;gap:10px;z-index:9999}
  .toast{background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02)); padding:10px 14px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);box-shadow:0 8px 20px rgba(3,7,18,0.6);min-width:220px}
  .toast.success{border-left:4px solid var(--success)}
  .toast.warn{border-left:4px solid var(--accent)}
  .toast.danger{border-left:4px solid var(--danger)}
  .difficulty-picker{display:flex;gap:8px;flex-wrap:wrap}
  .mini-input{width:58px;padding:6px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:inherit}
  .footer-note{font-size:12px;color:var(--muted);margin-top:8px}

  /* nice icons */
  .icon{width:18px;height:18px;display:inline-block}
  .flag-svg{width:14px;height:14px}
  .smaller{font-size:13px}
  .best-times{display:flex;flex-direction:column;gap:8px}
  .best-item{display:flex;justify-content:space-between;color:var(--muted);font-size:13px}
  .brand{display:flex;gap:10px;align-items:center}
  .round-sm{width:36px;height:36px;border-radius:10px;display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,#083047,#04202a);border:1px solid rgba(255,255,255,0.03)}
</style>
</head>
<body>
<div class="container">
  <div class="left panel">
    <header class="app-header">
      <div>
        <div class="brand">
          <div class="round-sm"><svg viewBox="0 0 24 24" fill="none" width="20" height="20"><path d="M3 5h18v14H3z" stroke="#7dd3fc" stroke-width="1.2" stroke-linejoin="round" stroke-linecap="round"/><path d="M9 9h6v6H9z" fill="#7dd3fc" opacity="0.12"/></svg></div>
          <div>
            <h1>Elegant Minesweeper</h1>
            <div class="subtitle">clean, polished, keyboard friendly</div>
          </div>
        </div>
      </div>
      <div class="controls">
        <button id="new-btn" class="btn">â†º New Game</button>
        <button id="sound-toggle" class="btn ghost" title="Toggle sounds">ðŸ”Š</button>
        <button id="theme-toggle" class="btn ghost" title="Switch theme">ðŸŒ™</button>
      </div>
    </header>

    <div class="stats">
      <div class="stat">
        <div class="big" id="mine-count">10</div>
        <div class="small">mines</div>
      </div>
      <div class="stat">
        <div class="big" id="timer">00:00</div>
        <div class="small">time</div>
      </div>
      <div class="stat">
        <div class="big" id="flags-left">0</div>
        <div class="small">flags</div>
      </div>
    </div>

    <div style="margin-top:6px;display:flex;gap:8px;align-items:center;justify-content:space-between">
      <div class="difficulty-picker">
        <button class="btn ghost" data-d="easy">Easy</button>
        <button class="btn ghost" data-d="medium">Medium</button>
        <button class="btn ghost" data-d="hard">Hard</button>
        <button class="btn ghost" id="custom-btn">Custom</button>
      </div>

      <div style="display:flex;gap:8px;align-items:center">
        <label class="smaller" style="color:var(--muted)">Quick:</label>
        <button class="btn" id="quick-5">5x5</button>
        <button class="btn" id="quick-9">9x9</button>
      </div>
    </div>

    <div class="board-wrap">
      <div id="board" class="board" tabindex="0" aria-label="minesweeper board"></div>
    </div>

    <div class="footer-note">Tip: Right-click to flag, double-click a number to chord. Keyboard: arrows to move, Space to reveal, F to flag.</div>
  </div>

  <div class="right panel">
    <div style="display:flex;flex-direction:column;gap:12px">
      <div>
        <h3 style="margin:0 0 6px 0">Settings</h3>
        <div style="display:flex;flex-direction:column;gap:8px">
          <div style="display:flex;gap:8px;align-items:center">
            <label class="smaller" style="width:120px;color:var(--muted)">Difficulty</label>
            <select id="difficulty" class="mini-input">
              <option value="easy">Easy (9x9,10)</option>
              <option value="medium">Medium (16x16,40)</option>
              <option value="hard">Hard (16x30,99)</option>
              <option value="custom">Custom</option>
            </select>
          </div>
          <div style="display:flex;gap:8px;align-items:center">
            <label class="smaller" style="width:120px;color:var(--muted)">Rows</label>
            <input id="rows" type="number" class="mini-input" min="5" max="50" value="9">
            <label class="smaller" style="width:48px;color:var(--muted)">Cols</label>
            <input id="cols" type="number" class="mini-input" min="5" max="60" value="9">
          </div>
          <div style="display:flex;gap:8px;align-items:center">
            <label class="smaller" style="width:120px;color:var(--muted)">Mines</label>
            <input id="mines" type="number" class="mini-input" min="1" value="10" max="999">
            <button id="apply" class="btn ghost">Apply</button>
          </div>
          <div style="display:flex;gap:8px;align-items:center">
            <label class="smaller" style="width:120px;color:var(--muted)">Sound</label>
            <input type="checkbox" id="sound-enable" checked /> <label for="sound-enable" class="smaller">Enable</label>
          </div>
        </div>
      </div>

      <div>
        <h3 style="margin:0 0 6px 0">Best Times</h3>
        <div class="best-times" id="best-times">
          <div class="best-item"><span>Easy</span><span id="best-easy">â€”</span></div>
          <div class="best-item"><span>Medium</span><span id="best-medium">â€”</span></div>
          <div class="best-item"><span>Hard</span><span id="best-hard">â€”</span></div>
        </div>
        <div style="margin-top:8px;display:flex;gap:8px">
          <button id="reset-bests" class="btn ghost">Reset Bests</button>
          <button id="export-bests" class="btn">Export</button>
        </div>
      </div>

      <div>
        <h3 style="margin:0 0 6px 0">About</h3>
        <div style="color:var(--muted);font-size:13px">
          Polished Minesweeper with WebAudio tones, first-click safe placement, and animated tiles. Built to be fast and pretty. <br /><br />
          <span style="color:var(--muted)">Made with â™¥ â€” open to tweaks and extra skins.</span>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Toasts -->
<div class="toast-wrap" id="toasts" aria-live="polite"></div>

<script>
/* ---------- Minesweeper core with polished UI ---------- */
/* Global state */
const sounds = { enabled: true };
const TOASTS = document.getElementById('toasts');
const boardEl = document.getElementById('board');
const mineCountEl = document.getElementById('mine-count');
const timerEl = document.getElementById('timer');
const flagsLeftEl = document.getElementById('flags-left');
const newBtn = document.getElementById('new-btn');
const soundToggle = document.getElementById('sound-toggle');
const soundEnableChk = document.getElementById('sound-enable');
const difficultySel = document.getElementById('difficulty');
const rowsInput = document.getElementById('rows');
const colsInput = document.getElementById('cols');
const minesInput = document.getElementById('mines');
const applyBtn = document.getElementById('apply');
const bestEasy = document.getElementById('best-easy');
const bestMedium = document.getElementById('best-medium');
const bestHard = document.getElementById('best-hard');
const resetBests = document.getElementById('reset-bests');
const exportBests = document.getElementById('export-bests');
const quick5Btn = document.getElementById('quick-5');
const quick9Btn = document.getElementById('quick-9');

let config = { rows:9, cols:9, mines:10 };
let grid = []; // cells
let started = false;
let timer = null, timeStart = null;
let focusCell = {r:0,c:0};
let flagsLeft = 0;
let remainingReveal = 0;
let status = 'idle'; // playing, lost, won

/* Audio via WebAudio - compact tones */
const AudioCtx = window.AudioContext || window.webkitAudioContext;
let actx = null;
function ensureAudio(){
  if(!actx) actx = new AudioCtx();
}
function playTone(freq, type='sine', dur=0.09, gain=0.12){
  if(!sounds.enabled) return;
  ensureAudio();
  try {
    const g = actx.createGain(); g.gain.value = gain;
    const o = actx.createOscillator(); o.type = type; o.frequency.value = freq;
    o.connect(g); g.connect(actx.destination);
    o.start();
    o.stop(actx.currentTime + dur);
    g.gain.exponentialRampToValueAtTime(0.0001, actx.currentTime + dur);
  } catch(e){}
}
function playClick(){ playTone(880,'triangle',0.06,0.08); }
function playFlag(){ playTone(620,'sine',0.12,0.12); playTone(320,'square',0.10,0.06); }
function playExplode(){ playTone(140,'sawtooth',0.4,0.32); }
function playWin(){ playTone(980,'sine',0.06,0.08); playTone(1280,'sine',0.06,0.06); playTone(1560,'sine',0.08,0.08); }

/* Utilities */
function randInt(n){ return Math.floor(Math.random()*n); }
function inBounds(r,c){ return r>=0 && c>=0 && r<config.rows && c<config.cols; }
function neighbors(r,c){ const arr=[]; for(let dr=-1;dr<=1;dr++) for(let dc=-1;dc<=1;dc++){ if(dr===0&&dc===0) continue; const nr=r+dr, nc=c+dc; if(inBounds(nr,nc)) arr.push({r:nr,c:nc}); } return arr; }

/* Toasts */
function toast(text, type='') {
  const t = document.createElement('div'); t.className='toast '+(type||'');
  t.textContent = text;
  TOASTS.appendChild(t);
  setTimeout(()=> t.style.transform='translateX(0)',20);
  setTimeout(()=>{ t.style.opacity='0'; t.style.transform='translateX(12px)'; setTimeout(()=>t.remove(),350); }, 3500);
}

/* Best times */
const BEST_KEY = 'elegant_mines_best';
function loadBests(){
  const raw = localStorage.getItem(BEST_KEY);
  const def = { easy:null, medium:null, hard:null };
  if(!raw) return def;
  try { return JSON.parse(raw); } catch(e){ return def; }
}
function saveBests(obj){ localStorage.setItem(BEST_KEY, JSON.stringify(obj)); }
function updateBestUI(){
  const b = loadBests();
  bestEasy.textContent = b.easy ? formatTime(b.easy) : 'â€”';
  bestMedium.textContent = b.medium ? formatTime(b.medium) : 'â€”';
  bestHard.textContent = b.hard ? formatTime(b.hard) : 'â€”';
}

/* Format time */
function formatTime(sec){
  const s = Math.floor(sec%60).toString().padStart(2,'0');
  const m = Math.floor(sec/60).toString().padStart(2,'0');
  return `${m}:${s}`;
}

/* Build board DOM & state */
function buildBoard(){
  boardEl.innerHTML = '';
  boardEl.style.gridTemplateColumns = `repeat(${config.cols}, auto)`;
  grid = [];
  remainingReveal = config.rows * config.cols - config.mines;
  for(let r=0;r<config.rows;r++){
    const row=[];
    for(let c=0;c<config.cols;c++){
      const cell = {
        r,c,
        mine:false,
        revealed:false,
        flagged:false,
        number:0,
        el:null
      };
      const div = document.createElement('button');
      div.className='tile hidden';
      div.setAttribute('data-r',r);
      div.setAttribute('data-c',c);
      div.setAttribute('aria-label','hidden');
      div.addEventListener('contextmenu',onRightClick);
      div.addEventListener('click',onLeftClick);
      div.addEventListener('dblclick',onDoubleClick);
      div.addEventListener('mousedown', (e)=> e.preventDefault()); // avoid focus shift
      grid.push(cell);
      cell.el = div;
      boardEl.appendChild(div);
    }
  }
  // convert grid to 2D index helper via index = r*cols + c
  updateHUD();
}

/* Helpers to get cell by r,c */
function cellAt(r,c){ if(!inBounds(r,c)) return null; return grid[r*config.cols + c]; }

/* place mines but ensure first click safe */
function placeMines(firstR, firstC){
  const total = config.rows*config.cols;
  const avoid = new Set();
  // avoid first clicked + neighbors
  avoid.add(firstR*config.cols + firstC);
  neighbors(firstR, firstC).forEach(n => avoid.add(n.r*config.cols + n.c));
  let placed=0;
  while(placed < config.mines){
    const idx = randInt(total);
    if(avoid.has(idx)) continue;
    const c = grid[idx];
    if(c.mine) continue;
    c.mine = true; placed++;
  }
  // set numbers
  for(let r=0;r<config.rows;r++) for(let c=0;c<config.cols;c++){
    const cell = cellAt(r,c);
    if(cell.mine) continue;
    const n = neighbors(r,c).reduce((acc,nbr)=> acc + (cellAt(nbr.r,nbr.c).mine?1:0), 0);
    cell.number = n;
  }
}

/* reveal flood fill */
function revealCell(cell){
  if(cell.revealed || cell.flagged) return;
  cell.revealed = true;
  cell.el.classList.remove('hidden');
  cell.el.classList.add('revealed');
  cell.el.setAttribute('aria-label','revealed');
  if(cell.mine){
    cell.el.classList.add('mine');
    cell.el.innerHTML = 'ðŸ’£';
    return;
  }
  remainingReveal--;
  if(cell.number>0){
    cell.el.textContent = cell.number;
    cell.el.classList.add('number-'+cell.number);
  } else {
    cell.el.textContent = '';
    // flood neighbors
    neighbors(cell.r,cell.c).forEach(n=>{
      const ncell = cellAt(n.r,n.c);
      if(ncell && !ncell.revealed && !ncell.mine) revealCell(ncell);
    });
  }
}

/* chord: double-click reveal surrounding if flag count matches number */
function chord(cell){
  if(!cell.revealed || cell.number===0) return;
  const around = neighbors(cell.r,cell.c);
  const flaggedCount = around.reduce((acc,n)=> acc + (cellAt(n.r,n.c).flagged?1:0), 0);
  if(flaggedCount !== cell.number) return;
  let exploded = false;
  around.forEach(n=>{
    const neighbor = cellAt(n.r,n.c);
    if(!neighbor.revealed && !neighbor.flagged){
      if(neighbor.mine) { exploded = true; neighbor.revealed = true; }
      revealCell(neighbor);
    }
  });
  if(exploded) endGame(false);
}

/* game over */
function endGame(won){
  status = won ? 'won' : 'lost';
  if(timer) { clearInterval(timer); timer=null; }
  // reveal all mines
  grid.forEach(c=>{
    if(c.mine && !c.flagged){
      c.revealed = true; c.el.classList.remove('hidden'); c.el.classList.add('mine'); c.el.innerHTML='ðŸ’£';
    }
  });
  if(won){
    playWin();
    toast('You won! ðŸŽ‰', 'success');
    checkBest();
  } else {
    playExplode();
    toast('Boom â€” you hit a mine', 'danger');
  }
  // disable further events lightly
}

/* check best times */
function checkBest(){
  const secs = Math.floor((Date.now() - timeStart)/1000);
  // map difficulty by config
  const b = loadBests();
  const key = getDifficultyKey();
  if(!key) return;
  if(!b[key] || secs < b[key]){
    b[key] = secs; saveBests(b); updateBestUI();
    toast(`New best time for ${key}: ${formatTime(secs)} â­`, 'success');
  }
}

/* difficulty key */
function getDifficultyKey(){
  if(config.rows===9 && config.cols===9 && config.mines===10) return 'easy';
  if(config.rows===16 && config.cols===16 && config.mines===40) return 'medium';
  if(config.rows===16 && config.cols===30 && config.mines===99) return 'hard';
  return null;
}

/* reset game */
function resetGame(startR=0,startC=0){
  started=false; status='playing'; focusCell={r:0,c:0};
  if(timer){ clearInterval(timer); timer=null; }
  timeStart = null; timerEl.textContent='00:00';
  buildBoard();
  flagsLeft = config.mines; updateHUD();
}

/* start on first click */
function startIfNeeded(fr,fc){
  if(started) return;
  placeMines(fr,fc);
  started=true;
  timeStart = Date.now();
  timer = setInterval(()=> {
    const s = Math.floor((Date.now()-timeStart)/1000);
    timerEl.textContent = formatTime(s);
  }, 500);
}

/* update HUD */
function updateHUD(){
  mineCountEl.textContent = config.mines;
  flagsLeftEl.textContent = flagsLeft;
}

/* click handlers */
function onLeftClick(e){
  const r = parseInt(this.getAttribute('data-r')), c = parseInt(this.getAttribute('data-c'));
  const cell = cellAt(r,c);
  if(status!=='playing' && status!=='idle') return;
  if(!started){
    startIfNeeded(r,c);
  }
  if(cell.flagged || cell.revealed) return;
  playClick();
  if(cell.mine){
    // reveal explode
    cell.revealed=true; cell.el.classList.remove('hidden'); cell.el.classList.add('mine'); cell.el.innerHTML='ðŸ’£';
    endGame(false);
    return;
  }
  revealCell(cell);
  if(remainingReveal<=0){
    endGame(true);
  }
}

function onRightClick(e){
  e.preventDefault();
  const r = parseInt(this.getAttribute('data-r')), c = parseInt(this.getAttribute('data-c'));
  const cell = cellAt(r,c);
  if(status!=='playing' && status!=='idle') return;
  if(!started) return; // don't place flags before starting
  if(cell.revealed) return;
  cell.flagged = !cell.flagged;
  if(cell.flagged){
    cell.el.classList.add('flagged');
    cell.el.innerHTML = 'ðŸš©';
    flagsLeft--;
    playFlag();
  } else {
    cell.el.classList.remove('flagged');
    cell.el.innerHTML = '';
    flagsLeft++;
    playClick();
  }
  updateHUD();
}

/* double click chord */
function onDoubleClick(e){
  const r = parseInt(this.getAttribute('data-r')), c = parseInt(this.getAttribute('data-c'));
  const cell = cellAt(r,c);
  chord(cell);
  if(remainingReveal<=0) endGame(true);
}

/* UI controls */
newBtn.addEventListener('click', ()=> resetGame());
soundToggle.addEventListener('click', ()=>{
  sounds.enabled = !sounds.enabled; soundEnableChk.checked = sounds.enabled;
  soundToggle.textContent = sounds.enabled ? 'ðŸ”Š' : 'ðŸ”ˆ';
  toast(`Sounds ${sounds.enabled?'on':'off'}`, 'warn');
});
soundEnableChk.addEventListener('change', ()=> { sounds.enabled = soundEnableChk.checked; soundToggle.textContent = sounds.enabled ? 'ðŸ”Š':'ðŸ”ˆ'; });

document.getElementById('apply').addEventListener('click', ()=>{
  const r = Math.max(5,Math.min(50,parseInt(rowsInput.value||9)));
  const c = Math.max(5,Math.min(60,parseInt(colsInput.value||9)));
  let m = Math.max(1,parseInt(minesInput.value||10));
  const maxM = Math.floor(r*c*0.75);
  m = Math.min(m,maxM);
  config = { rows:r, cols:c, mines:m };
  resetGame();
});

difficultySel.addEventListener('change', ()=>{
  const v = difficultySel.value;
  if(v==='easy'){ rowsInput.value=9; colsInput.value=9; minesInput.value=10; }
  else if(v==='medium'){ rowsInput.value=16; colsInput.value=16; minesInput.value=40; }
  else if(v==='hard'){ rowsInput.value=16; colsInput.value=30; minesInput.value=99; }
  else { /* custom */ }
  applyBtn.click();
});

document.querySelectorAll('.difficulty-picker .btn[data-d]').forEach(b=>{
  b.addEventListener('click', ()=>{
    const d = b.getAttribute('data-d');
    if(d==='easy'){ difficultySel.value='easy'; difficultySel.dispatchEvent(new Event('change')); }
    if(d==='medium'){ difficultySel.value='medium'; difficultySel.dispatchEvent(new Event('change')); }
    if(d==='hard'){ difficultySel.value='hard'; difficultySel.dispatchEvent(new Event('change')); }
  });
});

document.getElementById('custom-btn').addEventListener('click', ()=>{
  difficultySel.value='custom'; rowsInput.focus();
});

quick5Btn.addEventListener('click', ()=>{ rowsInput.value=5; colsInput.value=5; minesInput.value=3; difficultySel.value='custom'; applyBtn.click(); resetGame(); });
quick9Btn.addEventListener('click', ()=>{ rowsInput.value=9; colsInput.value=9; minesInput.value=10; difficultySel.value='easy'; applyBtn.click(); resetGame(); });

/* keyboard support */
boardEl.addEventListener('keydown', (e)=>{
  const key = e.key;
  if(status!=='playing' && status!=='idle') return;
  if(key==='ArrowUp'){ focusCell.r = Math.max(0, focusCell.r-1); focusCellSet(); e.preventDefault(); }
  if(key==='ArrowDown'){ focusCell.r = Math.min(config.rows-1, focusCell.r+1); focusCellSet(); e.preventDefault(); }
  if(key==='ArrowLeft'){ focusCell.c = Math.max(0, focusCell.c-1); focusCellSet(); e.preventDefault(); }
  if(key==='ArrowRight'){ focusCell.c = Math.min(config.cols-1, focusCell.c+1); focusCellSet(); e.preventDefault(); }
  if(key===' '){ // reveal
    const cell = cellAt(focusCell.r, focusCell.c);
    if(!cell) return;
    cell.el.click();
    e.preventDefault();
  }
  if(key.toLowerCase()==='f'){ // flag
    const cell = cellAt(focusCell.r, focusCell.c);
    if(!cell || cell.revealed) return;
    // simulate right click
    const ev = new MouseEvent('contextmenu', { bubbles:true, cancelable:true });
    cell.el.dispatchEvent(ev);
    e.preventDefault();
  }
});

function focusCellSet(){
  // clear previous focus
  document.querySelectorAll('.tile').forEach(t=> t.style.outline='none');
  const c = cellAt(focusCell.r, focusCell.c);
  if(c){ c.el.style.outline='2px solid rgba(125,211,252,0.14)'; c.el.style.outlineOffset='2px'; c.el.focus(); }
}

/* export/import bests */
resetBests.addEventListener('click', ()=>{
  saveBests({easy:null,medium:null,hard:null});
  updateBestUI(); toast('Best times reset', 'warn');
});
exportBests.addEventListener('click', ()=>{
  const data = localStorage.getItem(BEST_KEY) || '{}';
  navigator.clipboard?.writeText(data).then(()=> toast('Best times exported to clipboard','warn'), ()=> toast('Copy failed','danger'));
});

/* Persist settings */
window.addEventListener('beforeunload', ()=> {
  /* no-op for now */
});

/* init */
function init(){
  // initial config load
  rowsInput.value = config.rows; colsInput.value = config.cols; minesInput.value=config.mines;
  buildBoard();
  updateBestUI();
  flagsLeft = config.mines; updateHUD();
  // focus board for keyboard
  boardEl.tabIndex = 0;
  boardEl.focus();
  focusCellSet();
  // theme toggle quick
  document.getElementById('theme-toggle').addEventListener('click', ()=> {
    document.body.style.background = document.body.style.background ? '' : 'linear-gradient(180deg,#06121b,#08202b)';
    toast('Theme toggled', 'warn');
  });
  // small accessibility: focus cell when clicking board container
  boardEl.addEventListener('click', ()=> boardEl.focus());
}

init();

/* Accessibility: make tiles keyboard focusable as well */
document.addEventListener('click', (e)=>{
  if(e.target.classList.contains('tile')) {
    const r = parseInt(e.target.getAttribute('data-r')), c = parseInt(e.target.getAttribute('data-c'));
    focusCell = {r,c}; focusCellSet();
  }
});
</script>
</body>
</html>
